<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hdc.rjxy.mapper.RatingSnapshotMapper">

    <insert id="insert">
        INSERT IGNORE INTO rating_snapshot(user_id, platform_id, handle, rating, contest_name, contest_rank, snapshot_time)
        VALUES (#{userId}, #{platformId}, #{handle}, #{rating}, #{contestName}, #{rank}, #{snapshotTime})
    </insert>

    <select id="findLast" resultType="hdc.rjxy.pojo.vo.RatingPointVO">
        SELECT
        snapshot_time AS time,
        rating AS rating,
        contest_name AS contestName,
        contest_rank AS `rank`
        FROM rating_snapshot
        WHERE user_id = #{userId}
        AND platform_id = #{platformId}
        AND handle = #{handle}
        ORDER BY snapshot_time DESC
        LIMIT 1
    </select>

    <select id="listByTimeRange" resultType="hdc.rjxy.pojo.vo.RatingPointVO">
        SELECT
        snapshot_time AS time,
        rating AS rating,
        contest_name AS contestName,
        contest_rank AS `rank`
        FROM rating_snapshot
        WHERE user_id = #{userId}
        AND platform_id = #{platformId}
        AND handle = #{handle}
        AND snapshot_time &gt;= #{start}
        AND snapshot_time &lt;= #{end}
        ORDER BY snapshot_time ASC
    </select>

    <select id="findFirstInRange" resultType="hdc.rjxy.pojo.vo.RatingPointVO">
        SELECT
        snapshot_time AS time,
        rating AS rating,
        contest_name AS contestName,
        contest_rank AS `rank`
        FROM rating_snapshot
        WHERE user_id = #{userId}
        AND platform_id = #{platformId}
        AND handle = #{handle}
        AND snapshot_time &gt;= #{start}
        AND snapshot_time &lt;= #{end}
        ORDER BY snapshot_time ASC
        LIMIT 1
    </select>

    <select id="findLastInRange" resultType="hdc.rjxy.pojo.vo.RatingPointVO">
        SELECT
        snapshot_time AS time,
        rating AS rating,
        contest_name AS contestName,
        contest_rank AS `rank`
        FROM rating_snapshot
        WHERE user_id = #{userId}
        AND platform_id = #{platformId}
        AND handle = #{handle}
        AND snapshot_time &gt;= #{start}
        AND snapshot_time &lt;= #{end}
        ORDER BY snapshot_time DESC
        LIMIT 1
    </select>

</mapper>